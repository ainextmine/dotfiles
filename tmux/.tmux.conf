set-option -g history-limit 10000
# 告訴 tmux 預設就用 screen-256color
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
# Ghostty 專用設定
set -ga terminal-overrides ",ghostty:Tc:sitm=\E[3m:ritm=\E[23m:smxx=\E[9m:rmxx=\E[29m"

set -g prefix C-a
unbind C-b

bind-key C-a send-prefix

unbind %
bind | split-window -h

unbind '"'
bind - split-window -v

unbind r
bind r source-file ~/.tmux.conf

bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

bind -r m resize-pane -Z

set -g mouse on

set-window-option -g mode-keys vi

bind-key -T copy-mode-vi 'v' send -X begin-selection 
bind-key -T copy-mode-vi 'y' send -X copy-selection

# 啟用剪貼簿支援 (支援 SSH)
set -g set-clipboard on

# 支援 iTerm2 的 OSC 52 剪貼簿
set-option -g set-clipboard external

# 啟用滑鼠選取後自動複製到系統剪貼簿
# 使用 pbcopy (macOS) 或 OSC 52 序列
if-shell "uname | grep -q Darwin" \
  'bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"' \
  'bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "printf '\''\\033]52;c;%s\\a'\'' \"\$(base64 | tr -d '\'\\n\'')\""'

# tpm plugin
set -g @plugin 'tmux-plugins/tpm'

# List of tmux plugins
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'  # persist tmux sessions after computer restart
set -g @plugin 'tmux-plugins/tmux-continuum'   # automatically saves sessions for you every 15 minutes
set -g @plugin 'jimeh/tmux-themepack'          # 提供多種主題
# set -g @plugin 'erikw/tmux-powerline'          # orange 怕會失敗

# tmux-resurrect 設定
set -g @resurrect-capture-pane-contents 'on'   # 保存 pane 內容

# tmux-continuum 設定
set -g @continuum-restore 'on'                 # 自動恢復 sessions
set -g @continuum-save-interval '15'           # 每 15 分鐘自動儲存一次

# tmux-themepack 設定
# set -g @themepack 'powerline/double/orange'    # 使用 powerline 雙線橘色主題
set -g @themepack 'basic'                       # 改用基本主題避免渲染問題

# 只在最外層 session 顯示 status bar
set -g status on

# 如果已經在 tmux（nested session），就關掉內層的 status bar
# if-shell '[ -n "$TMUX" ]' 'set -g status off'

# 修復 Ghostty 終端的狀態列重疊問題
# 限制狀態列寬度避免 Ghostty 渲染問題
set -g status-left-length 20
set -g status-right-length 60

# 偵測到本地視窗大小改變時，自動調整 pane／window
set -g aggressive-resize on

# 關閉自動改名，避免 TERM 被覆寫
set -g allow-rename off

# 避免重繪延遲
set -s escape-time 0

# 強制狀態列在底部
set -g status-position bottom

# 調整重繪頻率
set -g status-interval 1

# Initialize TMUX plugin manager （keep this Line at the very bottom of tmux.conf） 
run '~/.tmux/plugins/tpm/tpm'



